{% comment %} 
 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
    <div class="container">
        <main class="main-content">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- File Upload Section -->
                <h1>SAP GUIDANCE</h1>

                <div class="form-group">
                    <form id="upload-form" action="{{ url_for('upload_file') }}" method="post" enctype="multipart/form-data">
                        <input type="file" name="file" required>
                        <button type="submit">Upload File</button>
                    </form>
                </div>

                <!-- File List and Delete Section -->
                <div class="file-list">
                    <h2>Uploaded Files</h2>
                    {% if files %}
                        <ul>
                            {% for file in files %}
                                <li class="file-item">
                                    {{ file }} 
                                    <a href="{{ url_for('delete_file', filename=file) }}">Delete</a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No files available.</p>
                    {% endif %}
                </div>

                <!-- Select Document and Language Section -->
                <div class="form-group">
                    <select id="selected_file" name="selected_file" required>
                        <option value="">Select a document</option>
                        {% for file in files %}
                            <option value="{{ file }}">{{ file }}</option>
                        {% endfor %}
                    </select>
                    <span id="doc-selection-message" class="doc-selection-message"></span>
                </div>
                <div class="form-group">
                    <select id="selected_language" name="selected_language" required>
                        <option value="en">English</option>
                        <option value="gu">Gujarati</option>
                        <option value="hi">Hindi</option>
                        <option value="ta">Tamil</option>
                    </select>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Chatbox Container with Scrolling -->
                <div id="chatbox-container">
                    <div id="result-box" class="chatbox-window">
                        <!-- Results will appear here -->
                    </div>
                </div>

                <div class="form-group">
                    <div class="textarea-wrapper">
                        <textarea id="query_text" name="query_text" placeholder="Type your question here..." required></textarea>
                        <div id="loader-container" class="loader-container" style="display: none;">
                            <div class="loader"></div>
                        </div>
                        <button id="ask-question-btn" type="button">&#x2B06;</button> <!-- Thicker upward arrow -->
                    </div>
                </div>

                <!-- Feedback section to be integrated within chat responses -->
                <div class="feedback-section">
                    <div class="feedback-box" style="display: none;">
                        <div class="feedback-input">
                            <textarea class="feedback-text" placeholder="Please provide your feedback..."></textarea>
                            <button class="submit-feedback">Submit</button>
                        </div>
                        <span class="feedback-error" style="color:red; display:none;">Please provide feedback.</span>
                    </div>
                </div>
                
                <!-- Popup Message -->
                <div class="feedback-popup" style="display:none; position:fixed; 
                top:50%; left:50%; transform:translate(-50%, -50%); background-color:#96DFF7; 
                color:white; padding:10px; border-radius:5px;">
                    Your feedback has been submitted successfully!
                </div>            
            </div>
        </main>
    </div>
    <script src="script.js"></script>
</body>
</html> {% endcomment %}








body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    margin-top: 4px;
    margin-bottom:80px;
    padding: 0;
    font-size: 15px;
    overflow: hidden;  /*Prevent scrolling of the page */
}

.container {
    width: 100%;
    max-width: 1200px;
    margin: 0px auto;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden; /* Ensure the container doesn't scroll */
}
 header {
     text-align: center;
     margin-bottom: 20px;
 }
 .left-panel h1 {
     width: 78%;
     background-color: green; /* Background color */
     color: #fff;
     padding: 5px 5px;
     border-radius: 5px;
     display: inline-block; /* Restrict background to content width */
     text-align:center;
     margin-bottom: 40px;
     margin-top: 0px;
 }
 
 .main-content {
     display: flex;
     justify-content: space-between; 
     font-size: 15px;
 } 
 .left-panel {
     width: 50%;
     display: flex;
     flex-direction: column;
     gap: -10px;
     margin-left: 0px;

 }
 /* .right-panel {
     width: 120%; 
     display: flex;
     flex-direction: column;
     margin-left: 0px;
 } */

 .right-panel {
    width: 120%; /* Adjusted to fit with the left panel */
    display: flex;
    flex-direction: column;
    margin-left: 0px;
    overflow-y: auto; /* Enable scrolling within the right panel */
    max-height: 100vh; /* Ensure the right panel doesn't exceed the viewport height */
}


 .form-group {
     margin-bottom: 50px;
 }
 input[type="file"] {
     width: 80%; /* Medium size */
     border-radius: 4px;
     border: 1px solid #ccc;
     padding: 8px;
     box-sizing: border-box;
     margin-bottom: 10px;
 }
 .textarea-wrapper {
    position: relative; /* Enable positioning for the button */
    width: 100%; /* Set to 100% of the container */
}

textarea {
    width: 100%; /* Full width */
    height: 55px; /* Larger height */
    margin-top: 25px; /* Space above */
    padding: 10px; /* Inner padding */
    border: 1px solid #ccc; /* Border */
    border-radius: 28px; /* Rounded corners */
    background: #fff; /* White background */
    box-sizing: border-box; /* Include padding and border in width/height */
    font-size: 15px; /* Font size */
    resize: none; /* Prevent resizing */
}

#ask-question-btn {
    position: absolute; /* Position the button inside the wrapper */
    top: 27.5px; /* Position the button higher if needed */
    right: 3px; /* Align it to the right */
    width: 50px; /* Increase width to accommodate larger arrow */
    height: 50px; /* Increase height to match width */
    background: green; /* Background color */
    color: #fff; /* Text color */
    border: none; /* No border */
    border-radius: 50%; /* Make it round */
    cursor: pointer; /* Pointer cursor */
    font-size: 35px; /* Larger font size for thicker arrow */
    font-weight: bold; /* Make the arrow thicker */
    display: flex; /* Use flexbox for centering */
    justify-content: center; /* Center horizontally */
    align-items: flex-start; /* Align items to the top of the button */
    transition: background 0.3s ease; /* Transition for hover effect */
    z-index: 1; /* Bring the button above the textarea */
    line-height: 0; /* Adjust line height to help center the arrow */
}


#ask-question-btn:hover {
    background: darkgreen; /* Darker green on hover */
}





/* Loader styles */
.loader-container {
    position: absolute; /* Position relative to textarea */
    top: 33px; /* Adjust position as needed */
    right: 10px; /* Align to the right */
    display: none; /* Hide by default */
    z-index: 1; /* Ensure it's above the textarea */
}

.loader {
    border: 4px solid #f3f3f3; /* Light grey */
    border-top: 4px solid green; /* Green */
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}


/* Hide Ask Question button initially (if you want to control its visibility via JavaScript later) */
#ask-question-btn.hidden {
    display: none; /* Use this class to hide the button */
}

button {
    width: 40%; /* Medium size */
    background: green;
    color: #fff;
    border: none;
    padding: 10px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s ease;
} 

button:hover {
    background: darkgreen;
}

 select {
     width: 80%; /* Ensure select takes up full width */
     border-radius: 4px;
     border: 1px solid #ccc;
     background: #fff;
     padding: 8px;
     box-sizing: border-box;
 }
 .chat-box {
     margin-top: px; /* Reduced top margin */
     width: 100%; /* Reduced width */
     border: 1px solid #ccc;
     padding: 2px;
     height: 90%;
     overflow-y: auto;
     background: #fff;
     border-radius: 8px;
     box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
     font-size: 15px;
 }
 /* .file-list {
     margin-top: -20px;
     margin-bottom:15px;
     width: 80%;
 } */

 .file-list {
    margin-top: -20px;
    margin-bottom: 15px;
    width: 80%;
    max-height: 200px; /* Adjust this height as needed */
    overflow-y: auto; /* Apply scrolling only for uploaded files */
}
 .file-list ul {
     list-style-type: disc; /* Changed from bullets to disc */
     padding: 0;
     font-size: 15px;
 }
 .file-item {
     margin: 8px 0;
     padding: 8px;
     background: #f8f8f8;
     border-radius: 4px;
     display: flex;
     justify-content: space-between;
     align-items: center;
     box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
     font-size: 14px;
 }
 .file-item a {
     color: #dc3545;
     text-decoration: none;
     font-weight: bold;
     transition: color 0.3s ease;
     font-size: 12px;
 }
 .file-item a:hover {
     color: #c82333;
 }
 /* Ensure the entire chatbox container has a fixed height and scroll only within this area */
 #chatbox-container {
     height: 400px; /* Adjust this as needed based on your layout */
     width: 100%; /* Full width of the container */
     border: 1px solid #ccc;
     border-radius:14px;
     padding: 10px;
     box-sizing: border-box;
     overflow: hidden; /* Ensure no scrollbar is visible here */
 }
 
 /* This is the actual scrollable chat window where messages will appear */
 .chatbox-window {
     height: 100%; /* Take the full height of the parent container */
     overflow-y: auto; /* Enable vertical scrolling within this element */
     overflow-x: hidden; /* Hide horizontal scrolling */
     padding-right: 10px; /* Add padding to avoid the scrollbar covering the text */
     display: flex;
     flex-direction: column;
     gap: 10px;
 }
 
 /* Styling for user and bot messages */
 .message-block {
     display: flex;
     flex-direction: column;
     gap: 10px;
     font-size: 15px;
 }
 
 .message-block .message {
     margin: 0;
     padding: 8px;
     border-radius: 4px;
     max-width: 95%;
     line-height: 1.5;
     box-sizing: border-box;
     font-size: 15px;
 }
 
 .message-block .user {
     background: #e0f7fa;
     color: #00796b;
     margin-left: auto; /* Aligns the user message to the right */
     text-align: right; /* Aligns text within the user message to the right */
 }
 
 .message-block .bot {
     background: #c8e6c9;
     color: black;
     margin-right: auto; /* Aligns the bot message to the left */
     text-align: left; /* Aligns text within the bot message to the left */
 }
 
 .doc-selection-message {
     display: block;
     margin-top: 10px;
     color: #dc3545;
     font-size: 15px;
 }
 .form-label {
     display: block;
     margin-bottom: 5px;
     font-weight: bold;
     color: #333;
     font-size: 15px;
 }

/* Feedback section styling */
.feedback-section {
display: flex; /* Use flexbox for layout */
align-items: center; /* Align items vertically */
gap: 5px; /* Reduce space between feedback icons and feedback box */
margin-top: -15px; /* Reduce space between the answer and feedback section */
}

/* Feedback icons (right and wrong symbols) */
.feedback-icons {
display: flex;
gap: 6px; /* Space between the correct and wrong symbols */
margin-right: 7px; /* Bring symbols closer to the answer */
}

.feedback-icons span {
cursor: pointer; /* Change cursor to pointer */
padding: 3px; /* Reduce padding around the symbols */
border-radius: 4px; /* Rounded corners for the symbols */
transition: background 0.3s ease, transform 0.2s ease; /* Smooth transition for hover and click effect */
font-size: 10px; /* Reduced size for the feedback symbols */
}

/* Hover effect for the feedback symbols */
.feedback-icons span:hover {
background-color: #e0e0e0; /* Light gray background on hover */
transform: scale(1.1); /* Slightly scale up the symbol on hover */
}

/* Feedback box styling */
.feedback-box {
display: flex;
flex-direction: column; /* Stack textarea and button vertically */
gap: 5px; /* Space between textarea and submit button */
margin-left: 2px; /* Bring feedback box closer to the feedback icons */
width: 600px; /* Increased width of the feedback box */
}

/* Feedback input styling */
.feedback-input {
display: flex; /* Use flexbox for layout */
align-items: center; /* Align items vertically */
gap: 5px; /* Space between textarea and button */
width: 100%; /* Use full width for the input section */
}

/* Feedback textarea styling */
.feedback-text {
flex-grow: 1; /* Allow textarea to take available space */
height: 40px; /* Set fixed height */
font-size: 12px; /* Smaller font */
padding: 5px; /* Padding inside the textarea */
border: 1px solid #ccc; /* Light gray border */
border-radius: 5px; /* Rounded corners */
resize: none; /* Disable textarea resizing */
}

/* Feedback submit button styling */
/* Feedback submit button styling */
.submit-feedback {
padding: 10px 10px; /* Adjust padding for a larger button */
font-size: 12px; /* Smaller text */
background-color: green; /* Button background color */
color: white; /* Button text color */
border: none; /* Remove borders */
border-radius: 3px; /* Rounded corners */
cursor: pointer; /* Pointer cursor on hover */
width: auto; /* Auto width to fit content */
min-width: 70px; /* Minimum width for the button to fit 'Submit' */
margin-top: 25px; /* Adds space above the button, pushing it down */
}


/* Hover effect for submit button */
.submit-feedback:hover {
background-color: green; /* Darker blue on hover */
}

/* Feedback error message styling */
.feedback-error {
color: red;
display: none; /* Initially hidden */
font-size: 11px; /* Smaller error message text */
margin-top: 5px; /* Space above error message */
}








document.addEventListener('DOMContentLoaded', function () {
    const askButton = document.getElementById('ask-question-btn');
    const resultBox = document.getElementById('result-box');
    const loaderContainer = document.getElementById('loader-container'); // Ensure loader is correctly referenced
    const selectedFile = document.getElementById('selected_file');
    const selectedLanguage = document.getElementById('selected_language');
    const queryText = document.getElementById('query_text');
    const docSelectionMessage = document.getElementById('doc-selection-message');

    function updateButtonVisibility() {
        askButton.style.display = (selectedFile.value !== '' && selectedLanguage.value !== '') ? 'block' : 'none';
    }

    // Function to handle sending data to answers.json
    function sendToAnswersJson(prompt, chatAns, humanAns) {
        const answerData = {
            Prompt: prompt,
            "Chat-Ans": chatAns,
            "Human-Ans": humanAns
        };

        fetch('/save_answers', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(answerData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Answer data saved:', data);
        })
        .catch(error => {
            console.error('Error saving answer data:', error);
        });
    }

    askButton.addEventListener('click', function () {
        if (selectedFile.value === '') {
            docSelectionMessage.textContent = 'Please select a document.';
            return;
        } else {
            docSelectionMessage.textContent = ''; // Clear message if valid
        }

        // Show loader and hide ask button
        loaderContainer.style.display = 'flex'; // Show loader as flex to center it
        askButton.style.display = 'none'; // Hide ask button

        const formData = new FormData();
        formData.append('query_text', queryText.value);
        formData.append('selected_file', selectedFile.value);
        formData.append('selected_language', selectedLanguage.value);

        fetch('/ask', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const question = queryText.value;
            const answer = data.answer;

            // Show question in chatbox
            resultBox.innerHTML += `
            <div class="message-block">
                <div class="message user">${question}</div>
                <div class="message bot">${answer}</div>
                <div class="feedback-section">
                    <div class="feedback-icons">
                        <span class="feedback correct">&#x2714;</span> <!-- Right symbol -->
                        <span class="feedback wrong">&#x274C;</span> <!-- Wrong symbol -->
                    </div>
                    <div class="feedback-box" style="display: none;">
                        <div class="feedback-input">
                            <textarea class="feedback-text" placeholder="Please provide your feedback..."></textarea>
                            <button class="submit-feedback">Submit</button>
                        </div>
                        <span class="feedback-error" style="color:red; display:none;">Please provide feedback.</span>
                    </div>
                </div>
            </div>`;
        
        

            // Scroll to the bottom of the chatbox
            resultBox.scrollTop = resultBox.scrollHeight;


           // Send answer data to answers.json if user clicks correct or wrong
document.querySelectorAll('.feedback.correct').forEach((correctButton, index) => {
    correctButton.addEventListener('click', function () {
        // Save correct answer in JSON
        const correctQuestion = document.querySelectorAll('.message.user')[index].textContent;
        const correctAnswer = document.querySelectorAll('.message.bot')[index].textContent;

        sendToAnswersJson(correctQuestion, correctAnswer, ""); // Human answer is empty for correct
        saveFeedback(correctQuestion, correctAnswer, true);
        
        // Display "Thank you" popup for correct answer feedback
        showSuccessPopup("Thank you for your Action.");
    });
});

document.querySelectorAll('.feedback.wrong').forEach((wrongButton, index) => {
    wrongButton.addEventListener('click', function () {
        // Show feedback box for wrong answers
        const feedbackBox = document.querySelectorAll('.feedback-box')[index];
        feedbackBox.style.display = 'block';

        // Handle submit feedback
        const submitFeedbackButton = feedbackBox.querySelector('.submit-feedback');
        submitFeedbackButton.addEventListener('click', function submitFeedbackHandler() {
            const feedbackText = feedbackBox.querySelector('.feedback-text').value;
            const feedbackError = feedbackBox.querySelector('.feedback-error');

            // Check if feedback is empty
            if (feedbackText.trim() === '') {
                feedbackError.style.display = 'block'; // Show error message
            } else {
                feedbackError.style.display = 'none'; // Hide error message

                const wrongQuestion = document.querySelectorAll('.message.user')[index].textContent;
                const wrongAnswer = document.querySelectorAll('.message.bot')[index].textContent;

                sendToAnswersJson(wrongQuestion, wrongAnswer, feedbackText); // Include feedback
                saveFeedback(wrongQuestion, wrongAnswer, false, feedbackText);

                // Hide the feedback box after submission
                feedbackBox.style.display = 'none';

                // Display "Your feedback has been submitted successfully!" popup for wrong answer feedback
                showSuccessPopup("Your feedback has been submitted successfully!");

                // Remove the event listener to prevent multiple submissions for the same feedback
                submitFeedbackButton.removeEventListener('click', submitFeedbackHandler);
            }
        });
    });
});

// Function to display the success popup message
function showSuccessPopup(message) {
    const feedbackPopup = document.createElement('div');
    feedbackPopup.classList.add('feedback-popup');
    feedbackPopup.style.position = 'fixed';
    feedbackPopup.style.top = '50%';
    feedbackPopup.style.left = '50%';
    feedbackPopup.style.transform = 'translate(-50%, -50%)';
    feedbackPopup.style.backgroundColor = '#96DFF7';
    feedbackPopup.style.color = 'black';
    feedbackPopup.style.padding = '20px';
    feedbackPopup.style.borderRadius = '5px';
    feedbackPopup.style.zIndex = '1000';
    feedbackPopup.textContent = message;

    document.body.appendChild(feedbackPopup);

    // Hide popup after 3 seconds
    setTimeout(function () {
        feedbackPopup.style.display = 'none';
        document.body.removeChild(feedbackPopup);
    }, 3000);
}


// Function to display the success popup message
function showSuccessPopup(message) {
    const feedbackPopup = document.createElement('div');
    feedbackPopup.classList.add('feedback-popup');
    feedbackPopup.style.position = 'fixed';
    feedbackPopup.style.top = '40%';
    feedbackPopup.style.left = '60%';
    feedbackPopup.style.transform = 'translate(-50%, -50%)';
    feedbackPopup.style.backgroundColor = '#96DFF7';
    feedbackPopup.style.color = 'black';
    feedbackPopup.style.padding = '5px';
    feedbackPopup.style.borderRadius = '5px';
    feedbackPopup.style.zIndex = '1000';
    feedbackPopup.textContent = message;

    document.body.appendChild(feedbackPopup);

    // Hide popup after 3 seconds
    setTimeout(function () {
        feedbackPopup.style.display = 'none';
        document.body.removeChild(feedbackPopup);
    }, 3000);
}


            // Clear the input text area after sending the question
            queryText.value = ''; 
        })
        .catch(error => {
            console.error('Error:', error);
        })
        .finally(() => {
            loaderContainer.style.display = 'none'; // Hide loader
            askButton.style.display = 'block'; // Show ask button again
        });
    });

    // Handle Enter and Shift+Enter in the textarea
    queryText.addEventListener('keypress', function (event) {
        if (event.key === 'Enter') {
            if (event.shiftKey) {
                // Allow new line
                return;
            } else {
                // Trigger ask button click
                askButton.click();
                event.preventDefault(); // Prevent new line
            }
        }
    });

    selectedFile.addEventListener('change', function () {
        if (selectedFile.value === '') {
            docSelectionMessage.textContent = 'Please select a document.';
        } else {
            docSelectionMessage.textContent = '';
        }
        updateButtonVisibility();
    });

    selectedLanguage.addEventListener('change', function () {
        updateButtonVisibility();
    });

    // Initialize button visibility on page load
    updateButtonVisibility();

    // Function to save feedback in a JSON file
    function saveFeedback(question, answer, isCorrect, feedback = '') {
        const feedbackData = {
            question: question,
            answer: answer,
            isCorrect: isCorrect,
            feedback: feedback
        };

        fetch('/save_feedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(feedbackData)
        })
        .then(response => response.json())
        .then(data => {
            console.log('Feedback saved:', data);
        })
        .catch(error => {
            console.error('Error saving feedback:', error);
        });
    }
});






